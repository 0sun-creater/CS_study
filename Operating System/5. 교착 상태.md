# 교착 상태란? (deadlock)
프로세스를 실행하기 위해서는 자원이 필요한데, 두 개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기다린다면 그 어떤 프로세스도 더 이상 진행할 수 없는 교착 상태가 된다.   

EX) 게임 프로세스는 자원 A를 점유한 채 웹 브라우저 프로세스가 점유하고 있는 자원 B의 사용이 끝나길 기다리고, 웹 브라우저 프로세스는 자원 B를 점유한 채 게임 프로세스의 자원 A 사용이 끝나길 기다리는 상황  

![image](https://github.com/0sun-creater/CS_study/assets/54173210/c64de1d0-6408-437a-9ad5-982bf7de3fc5)

### 뮤텍스 락에서 교착 상태 발생하는 경우
  1) A는 임계 구역 진입 전 lock1을 잠구고 (lock1=true)
  2) B는 임계 구역 진입 전 lock2를 잠갔다고 가정 (lock2=true)
  3) A는 lock2가 false가 되길 기다리고, B는 lock1이 false가 되길 기다림
  4) 교착 상태 발생
< 해결 방안 >
 (1) 교착 상태가 발생했을 때의 상황을 정확히 표현
 (2) 교착 상태가 일어나는 근본적인 이유에 대해 고민


 ## 자원 할당 그래프
 교착 상태를 단순하게 표현한 그래프
1. 프로세스는 원으로 자원의 종류는 사각형으로 표현
2. 사용할 수 있는 자원의 개수는 사각형 내에 점으로 표현
3. 프로세스가 어떤 자원을 할당받아 사용 중이라면 자원에서 프로세스를 향해 화살표 효시
4. 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표 표시
**5. 1~4가 완료 되었을 때 자원 할당 그래프에 cycle이 생긴다면 교착 상태가 발생한다.**
![image](https://github.com/0sun-creater/CS_study/assets/54173210/a0c59993-9b42-4b4d-a222-dc6c0a55a948)


## 교착 상태 발생 조건 4가지
### 1. 상호 배제
교착 상태 근본적인 원인 : 해당 자원을 한 번에 하나의 프로세스만 이용 가능했기 때문  
한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때 교착 상태 발생 가능성 있음     
 
### 2. 점유와 대기
어떠한 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태에서 교착 상태 발생 가능성 있음   

### 3. 비선점
비선점 자원은 그 자원을 이용하는 프로세스의 작업이 끝나야만 비로소 이용할 수 있음   
어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못할 때 교착 상태 발생 가능성 있음   
  
### 4. 원형 대기
프로세스들과 프로세스가 요청 및 할당받은 자원이 원의 형태를 이루었기 때문   
자원 할당 그래프가 원의 형태로 그려지면 교착 상태 발생 가능성 있음   


# 교착 상태 해결 방법
## 교착 상태 예방
발생 필요 조건 네 가지 중 하나를 충족하지 못하게 하는 방법  
프로세스들에 자원을 할당할 때 발생 조건 4 가지 중 하나의 조건이라도 만족시키지 않게 할당하면 교착 상태는 발생하지 않음   

1. 상호 배제 없애기
모든 자원을 공유 가능하게 만들기   
이론적으로 교착 상태를 없앨 수 있지만, 현실적으로 무리가 있음

2. 점유와 대기 없애기
운영체제는 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분하기
이론적으로 교착 상태를 없앨 수 있지만, 한 프로세스에 필요한 자원들을 몰아주고 그 다음에 필요한 자원들을 몰아줌
- 당장 자원이 필요해도 기다릴 수 밖에 없는 프로세스와 사용되지 않으면서 오랫동안 할당되는 자원을 다수 양산함
- 자원의 활용률이 낮아짐
- 자원을 많이 사용하는 프로세스는 동시에 자원을 사용할 타이밍을 확보하기 어려움 (기아 현상)

3. 비선점 조건 없애기
자원을 이용 중인 프로세스로부터 해당 자원을 빼앗을 수 있게 하기   
모든 자원이 선점 가능한 것이 아니기 때문에 한 프로세스의 작업이 끝날 때까지 다른 프로세스가 기다려야 하는 자원도 있음 ex) 프린터    
- 선점 가능한 일부 자원에 대해서는 효과적 ex) CPU
- 다소 범용성이 떨어짐

4. 원형 대기 조건 없애기
모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하기
- 비교적 현실적으로 실용적인 방식
- 수많은 자원에 번호를 붙이는 일은 복잡한 작업, 각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용률이 떨어질 수 있음

**결론 : 예방하는 방식은 모두 부작용이 따름**

## 교착 상태 회피
교착 상태가 발생하지 않을 정도로만 조심히 자원을 할당하는 방식   
교착 상태 = 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주   
- 안전 순서열 (safe sequence) : 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미
- 안전 상태 (safe state) : 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
                          안전 순서열대로 프로세스들에 자원을 배분하여 교착 상태가 발생하지 않는 상태
- 불안전 상태 (unsafe state) : 교착 상태가 발생할 수도 있는 상황 / 안전 순서열이 없는 상황

**결론 : 항시 안전 상태를 유지하도록 자원을 할당하면 회피가 가능하다**

## 교착 상태 검출 후 회복
교착 상태 발생을 인정하고 사후에 조치하는 방식  
프로세스들이 자원을 요구할 때마다 그때그때 모두 할당하며, 교착 상태 발생 여부를 주기적으로 검사함   
교착 상태가 검출되면 비로소 그때 아래 방식으로 회복함  

1. 선점을 통한 회복
교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
교착 상태가 해결될 때까지 다른 프로세스로부터 자원을 강제로 빼앗고 한 프로세스에 할당하는 방식

2. 프로세스 강제 종료를 통한 회복
가장 단순하면서 확실한 방식
- 교착 상태가 놓인 프로세스를 모두 강제 종료 : 확실하지만 작업 내역을 잃게 될 가능성 존재
- 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료 : 작업 내역을 잃는 프로세스를 최대한 줄이지만 교착 상태 여부 확인 과정에서 오버헤드 야기

## 타조 알고리즘 (ostrich algorithm)
교착 상태를 아예 무시하는 방법   
문제 발생의 빈도나 심각성에 따라 최대 효율을 추구하는 엔지니어 입장에서 때때로 적합할 때도 많다.  

